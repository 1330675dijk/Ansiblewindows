---
- name: Install AD DS role
  win_feature:
    name: AD-Domain-Services
    state: present

- name: Install Remote-Server-Administration-Tools
  win_feature:
    name: Remote-Server-Administration-Tools
    state: present
    restart: yes
    include_sub_features: yes
    include_management_tools: yes


- name: Install Windows Deployment Services
  win_feature:
    name: Windows-Deployment-Services
    state: present
    restart: yes
    include_sub_features: yes
    include_management_tools: yes

- name: Promote server to domain controller
  win_domain:
    dns_domain_name: "{{ domainname }}" 
    domain_admin_user: "{{ domainuser }}"
    domain_admin_password: "{{ domainpass }}" 
    safe_mode_password: "{{ domainpass }}" 
    state: "domain_controller"
    reboot: true
