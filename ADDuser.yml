---
- name: Create AD Users from CSV
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Read CSV file
      read_csv:
        path: gegevens.csv
      register: csv_content

    - name: Debug CSV Data
      debug:
        var: csv_content

    - name: Use CSV Data as Variables
      set_fact:
        users_data: "{{ csv_content.list }}"

    - name: Create Windows Domain Users
      win_domain_user:
        name: "{{ item.Gebruikersnaam }}"
        firstname: "{{item.Voornaam }}"
        surname: "{{ item.Achternaam }}"
        password: "Welkom123456"  # Set a secure password
        groups: "{{ item.groups|default(omit) }}"
        state: present
        email: '"{{ item.Gebruikersnaam }}"@{{ domainname }}'
        attributes: "{{ item.attributes|default(omit) }}"
      args:
        executable: C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe
      with_items: "{{ users_data }}"


#    - name: Create AD Users
 #     win_domain_user:
  #      name: "{{ item.Gebruikersnaam }}"
   #     firstname: "{{ item.Voornaam }}"
    #    surname: "{{ item.Achternaam }}"
     #   password: "Welkom123456"  # Set a secure password
      #  street_address: "{{ item.adres }}"
       # postal_code: "{{ item.postcode }}"
        #city: "{{ item.plaatsnaam }}"
        #state: present
        #domain_admin_user: "{{ domainuser }}"
        #domain_admin_password: "{{ domainpass }}" 
      #with_items: "{{ users_data }}"



